# Pytest Coverage Comment

This action comments a pull request with a HTML test coverage report.
The report is based on the coverage report generated by your test runner.
Note that this action does not run any tests, but expects the tests to have been run by another action already (support pytest only).

You can add this action to your GitHub workflow for Ubuntu runners (e.g. runs-on: ubuntu-latest) as follows:

```yaml
- name: Pytest coverage comment
  uses: MishaKav/pytest-coverage-comment@v1.0
  with:
    pytest-coverage: pytest-coverage.txt
```

## Inputs

| Name              | Required | Default               | Description                                                                           |
| ----------------- | -------- | --------------------- | ------------------------------------------------------------------------------------- |
| `pytest-coverage` |          | `pytest-coverage.txt` | The location of the txt output of pytest-coverage. Used to generate the comment       |
| `title`           |          | `Coverage Report`     | Title for the coverage report. Useful for monorepo projects                           |
| `badge-title`     |          | `Coverage`            | Title for the badge icon                                                              |
| `github-token`    | âœ“        | `${{github.token}}`   | An alternative GitHub token, other than the default provided by GitHub Actions runner |

## Output example

<img alt="Coverage" src="https://img.shields.io/badge/Coverage-30%25-red.svg" /><br/><details><summary>Coverage Report</summary><table><tr><th>File</th><th>Stmts</th><th>Miss</th><th>Cover</th><th>Missing</th></tr><tbody><tr><td colspan="5"><b>functions/example_completed</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_completed/example_completed.py">example_completed.py</a></td><td>64</td><td>19</td><td>70%</td><td><a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_completed/example_completed.py#L33">33</a>, <a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_completed/example_completed.py#L39-L45">39&ndash;45</a>, <a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_completed/example_completed.py#L48-L51">48&ndash;51</a>, <a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_completed/example_completed.py#L55-L58">55&ndash;58</a>, <a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_completed/example_completed.py#L65-L70">65&ndash;70</a>, <a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_completed/example_completed.py#L91-L92">91&ndash;92</a></td></tr><tr><td colspan="5"><b>functions/example_manager</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_manager/example_manager.py">example_manager.py</a></td><td>44</td><td>11</td><td>75%</td><td><a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_manager/example_manager.py#L31-L33">31&ndash;33</a>, <a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_manager/example_manager.py#L49-L55">49&ndash;55</a>, <a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_manager/example_manager.py#L67-L69">67&ndash;69</a></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_manager/example_static.py">example_static.py</a></td><td>40</td><td>2</td><td>95%</td><td><a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/example_manager/example_static.py#L60-L61">60&ndash;61</a></td></tr><tr><td colspan="5"><b>functions/my_exampels</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/my_exampels/example.py">example.py</a></td><td>20</td><td>20</td><td>0%</td><td><a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/my_exampels/example.py#L1-L31">1&ndash;31</a></td></tr><tr><td colspan="5"><b>functions/resources</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/resources/resources.py">resources.py</a></td><td>26</td><td>26</td><td>0%</td><td><a href="https://github.com/MishaKav/pytest-coverage-comment/blob/f9d42291812ed03bb197e48050ac38ac6befe4e5/functions/resources/resources.py#L1-L37">1&ndash;37</a></td></tr><tr><td><b>TOTAL</b></td><td><b>1055</b></td><td><b>739</b></td><td><b>30%</b></td><td>&nbsp;</td></tr></tbody></table></details>

## Example usage

The following is an example GitHub Action workflow that uses the Pytest Coverage Comment to extract the coverage to comment at pull request:

```yaml
name: pytest-coverage-comment
on:
  pull_request:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Set up Python 3.9
        uses: actions/setup-python@v2
        with:
          python-version: 3.9

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install flake8 pytest pytest-cov
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Build coverage file
        run: |
          pytest --cache-clear --cov=app --cov-report xml test/

      - name: Pytest coverage comment
        uses: MishaKav/pytest-coverage-comment@v1.0
        with:
          pytest-coverage: pytest-coverage.txt
```
